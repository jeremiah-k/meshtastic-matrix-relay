services:
  mmrelay:
    image: ghcr.io/jeremiah-k/mmrelay:latest
    container_name: meshtastic-matrix-relay
    restart: unless-stopped
    stop_grace_period: 30s
    user: "${UID:-1000}:${GID:-1000}"
    environment:
      - TZ=UTC # Set timezone (PYTHONUNBUFFERED and MPLCONFIGDIR are set in Dockerfile)

    # For BLE connections, uncomment the following lines (Linux only - not supported on Docker Desktop for macOS/Windows)
    # network_mode: host
    # privileged: true

    volumes:
      # Mount your config directory - create ~/.mmrelay/config.yaml first
      # See docs/DOCKER.md for setup instructions
      # For SELinux systems (RHEL/CentOS/Fedora), add :Z flag to prevent permission denied errors
      - ${MMRELAY_HOME:-$HOME}/.mmrelay/config.yaml:/app/config.yaml:ro,Z
      - ${MMRELAY_HOME:-$HOME}/.mmrelay:/app/data:Z
      # For non-SELinux systems, you can use:
      # - ${MMRELAY_HOME:-$HOME}/.mmrelay/config.yaml:/app/config.yaml:ro
      # - ${MMRELAY_HOME:-$HOME}/.mmrelay:/app/data

      # For BLE connections, uncomment the following lines (Linux only):
      # - /var/run/dbus:/var/run/dbus:ro                    # D-Bus for BlueZ communication
      # - /sys/class/bluetooth:/sys/class/bluetooth:ro     # Core Bluetooth device interfaces
      # - /sys/devices:/sys/devices:ro                     # Device hierarchy and hardware context
      # - /sys/bus/usb:/sys/bus/usb:ro                     # USB adapter support (only if using USB dongles)

    # Alternative BLE configuration with better security (production recommended):
    # cap_add:
    #   - NET_ADMIN    # Required for BLE network management
    #   - NET_RAW      # Required for raw socket access
    #   - SYS_ADMIN    # Required for Bluetooth device management
    # devices:
    #   - /dev/vhci:/dev/vhci  # Virtual HCI device access
    # cap_drop:
    #   - ALL          # Drop all other capabilities for security
    # read_only: true  # Read-only filesystem where possible
    # tmpfs:
    #   - /tmp
    #   - /var/tmp

    # Tip: For correct permissions and paths, ensure UID, GID, and MMRELAY_HOME are set in a .env file or exported
